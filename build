#!/bin/sh

set -e -x

# Setup make Command
make_fun() {
  make O=out ARCH=arm CC=clang HOSTCC=clang \
    AR=llvm-ar NM=llvm-nm OBJCOPY=llvm-objcopy \
    OBJDUMP=llvm-objdump STRIP=llvm-strip \
    CONFIG_SECTION_MISMATCH_WARN_ONLY=y \
    KCFLAGS=-w CONFIG_SECTION_MISMATCH_WARN_ONLY=y \
    CROSS_COMPILE=arm-linux-androideabi- "$@"
}

# Setting Toolchain Path
PATH="${WORK}/clang/bin:${WORK}/gcc/bin:/bin"
cd "${KERNEL_SRC}" || exit 1

# Start Compiling Kernel
make_fun "${KERNEL_DEFCONFIG}"
make_fun -j"$(nproc --all)" 2>&1 | tee build.log 
