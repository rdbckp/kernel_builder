#!/bin/sh

set -e -x

cd /home/runner/work/kernel_builder/kernel_builder/work
ls
echo ------------------------------------------------
echo ------------------------------------------------
echo ----------------- C H E C K --------------------
echo ------------------------------------------------
echo ------------------------------------------------
export PATH="${PWD}/clang/bin:${PWD}/gcc/bin:${PATH}"
echo $PATH
cd /home/runner/work/kernel_builder/kernel_builder/work/myKernel

# Setup make Command
export ARCH="arm"
export CC="clang"
export HOSTCC="clang"
export CROSS_COMPILE="${PATH}/arm-linux-androidkernel-"
export CLANG_TRIPLE="arm-linux-gnueabi-"
export KCFLAGS=-"w"
export CONFIG_SECTION_MISMATCH_WARN_ONLY="y"
export CFLAGS_WARN="-Wunused-but-set-variable"
export xxx="ARCH=arm CC=clang HOSTCC=clang CROSS_COMPILE=arm-linux-androidkernel- CLANG_TRIPLE=arm-linux-gnueabi- KCFLAGS=-w CONFIG_SECTION_MISMATCH_WARN_ONLY=y CFLAGS_WARN=-Wunused-but-set-variable"

# Start Compiling Kernel
cd /home/runner/work/kernel_builder/kernel_builder/work/myKernel
ls
echo ------------------------------------------------
echo ------------------------------------------------
echo ----------------- C H E C K --------------------
echo ------------------------------------------------
echo ------------------------------------------------
mkdir -p out
make $xxx O=out a02_defconfig
make $xxx O=out -j"$(nproc --all)" 2>&1 | tee build.log 
